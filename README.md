# Banner rotation service

## Проектная работа на курсе "Golang Developer. Professional" от Otus https://otus.ru/lessons/golang-professional/. 

## Общее описание сервиса "Ротация баннеров" 
Сервис "Ротация баннеров" предназначен для выбора наиболее эффективных (кликабельных) баннеров,
в условиях меняющихся предпочтений пользователей и набора баннеров.

Задача сервиса - осуществлять "ротацию" баннеров, показывая те, которые наиболее вероятно приведут 
к переходу в той или иной социально-демографической группе. Для этого предполагается использовать алгоритм "Многорукий бандит":
https://habr.com/ru/company/surfingbird/blog/168611/

<img src="./examples/banners-rotation/conceptual_model.png" width="800">

## Архитектура
Сервис состоит из API и базы данных в которой хранится информация о баннерах.
Сервис предоставляет GRPC.

## Используемые технологии и протоколы
    • AMQP
    • Docker
    • gRPC (Protocol Buffers)
    • HTTP
    • PostgreSQL
    • RabbitMQ

## Команды для запуска программы

### Развернуть базу данных в postgres в docker контейнере
``` 
sudo docker run --name=rotation.db -e POSTGRES_PASSWORD='qwerty' -p 5432:5432 -d postgres
CREATE DATABASE rotationservice
```

### Развернуть очереди сообщений  rabbitmq в docker контенере 
```
sudo docker run -d --name rb -p 15672:15672 -p 5672:5672 rabbitmq:3-management
```

(графический интерфейс доступен по адресу:  http://localhost:15672/  
логин:пароль –  guest:guest)

### Осуществить миграцию базы данных
```
cd migrations
goose postgres "postgres://postgres:123@localhost:5432/rotationservice?sslmode=disable" up
```

### Запустить команды в Makefile для старта сервиса
```
make run 
```

### Остановить сервис 
```
make down 
```

## Примеры запросов: 
```
```


## Описание сущностей
### Слот
Слот - место на сайте, на котором мы показываем баннер.
* ID
* Описание

### Баннер
Баннер - рекламный/информационный элемент, который показывается в слоте.
* ID
* Описание

Один баннер может участвовать в ротации в нескольких слотах.

Статистика по баннеру ведется в рамках одного слота.

### Соц-дем. группа пользователей
Соц-дем. группа - это группа пользователей сайта со схожими интересами,
например "девушки 20-25" или "дедушки 80+".
* ID
* Описание

## Описание методов (запросов на сервер)

### Добавить баннер
Добавляет новый баннер в ротацию в данном слоте.
* ID баннера
* ID слота

### Удалить баннер
Удаляет баннер из ротации в данном слоте.
* ID слота
* ID баннера

### Засчитать переход
Увеличивает счетчик переходов на 1 для указанного баннера в данном слоте в указанной группе.
* ID слота
* ID баннера
* ID соц-дем. группы

### Выбрать баннер для показа
Основной метод. Возвращает баннер, который следует показать в данный момент в указанном
слоте для указанной соц-дем. группы. Увеличивает число показов баннера в группе.

Принимает:
* ID слота
* ID соц-дем. группы

Возвращает:
* ID баннера

## Выгрузка статистики
Микросервис отправляет события кликов и показов в очередь (rabbitMQ)
для дальнейшей обработки в аналитических системах.

Формат событий следующий:
* Тип: клик или показ
* ID слота
* ID баннера
* ID соц.дем группы
* Дата и время
  
## Развертывание
Развертывание микросервиса осуществляется командой `make run` (внутри `docker compose up`)
в директории с проектом.


Техническое задание и его авторы указаны по ссылке: https://github.com/OtusGolang/final_project/blob/master/README.md